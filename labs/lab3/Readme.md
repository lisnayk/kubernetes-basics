# Лабораторна робота №3. Робота з об'єктами Deployment та Service

## Мета роботи

Опанувати створення, налаштування та аналіз об'єктів Deployment та Service у Kubernetes.

## Теоретичні відомості

В оточені Kubernetes робоче навантаження (програми, сервіси) працюють як контейнери в подах. Керувати кожним подом окремо — складно.
Kubernetes має засоби та змогу робити це автоматично.

Існують наступні вбудовані засоби для керування робочими навантаженнями:

- `Deployments` (та, опосередковано, `ReplicaSet` ) – найпоширеніший метод запуску програми в кластері. Розгортання добре підходить для керування робочим навантаженням програми без збереження стану на кластері, де будь-який Pod у розгортанні є взаємозамінним і може бути замінений за потреби. (`Deployments` є заміною застарілої версії `ReplicationController API`)/
- `StatefulSet` використовується для керування одним або декількома подами, які мають власну унікальну ідентичність і не є взаємозамінними. На відміну від Deployment, де всі Pod однакові й можуть легко замінювати один одного, у StatefulSet кожен Pod «пам’ятає», хто він. Найчастіше StatefulSet застосовують для роботи з базами даних або іншими сервісами, яким потрібне постійне сховище.
- `DaemonSet` — це спосіб запустити Pod на кожному вузлі кластера (або на вибраних вузлах). Його використовують тоді, коли певна служба повинна працювати безпосередньо на кожному вузлі — наприклад, мережевий плагін, лог-агент, моніторинг або драйвер доступу до сховища. Кожен Pod у DaemonSet працює подібно до системного демона в Linux — тобто це фоновий сервіс, який забезпечує роботу вузла або додає йому певні можливості.

### ReplicaSet

Призначення ReplicaSet — підтримувати стабільний набір реплік Pod’ів, що працюють у будь-який момент часу.

ReplicaSet має три основні складові:
- селектор — визначає, які Pod’и він контролює;
- кількість реплік (replicas) — скільки Pod’ів має працювати;
- шаблон Pod’а (pod template) — опис нових Pod’ів, які створюються за потреби.

ReplicaSet підтримує задану кількість Pod’ів, створюючи або видаляючи їх. Для створення нових Pod’ів використовується визначений шаблон.

Зв’язок між ReplicaSet і Pod’ами встановлюється через поле metadata.ownerReferences. Завдяки цьому ReplicaSet відстежує стан своїх Pod’ів і керує ними. Якщо з’являється Pod без контролера або такий, що відповідає селектору ReplicaSet, він автоматично береться під керування.

ReplicaSet гарантує роботу потрібної кількості Pod’ів, однак зазвичай його не використовують напряму. Рекомендується застосовувати Deployment — він керує ReplicaSet і забезпечує зручні механізми оновлення. Тому безпосередня робота з ReplicaSet у більшості випадків не потрібна.обитися.

```yaml
piVersion: apps/v1          # API-група/версія для об’єктів керування робочими навантаженнями
kind: ReplicaSet             # Тип ресурсу: підтримує потрібну кількість Pod’ів
metadata:                    # Метадані ресурсу
  name: frontend             # Ім’я ReplicaSet
  labels:                    # Мітки самого ReplicaSet (для пошуку/групування)
    app: guestbook           # Логічна належність до застосунку
    tier: frontend           # Роль/шар застосунку
spec:                        # Бажаний стан ReplicaSet
  replicas: 3                # Скільки Pod’ів має працювати одночасно
  selector:                  # За якими мітками ReplicaSet “впізнає” свої Pod’и
    matchLabels:
      tier: frontend         # Під контроль потраплять Pod’и з цією міткою
  template:                  # Шаблон Pod’а, який буде створюватись ReplicaSet
    metadata:
      labels:
        tier: frontend       # Мітки Pod’ів (мають відповідати selector)
    spec:                    # Специфікація Pod’а
      containers:
        - name: php-redis      # Назва контейнера в Pod’і
          image: us-docker.pkg.dev/google-samples/containers/gke/gb-frontend:v5  # Образ контейнера
```


`Deployments` керує набором подів (Pods) для виконання робочого навантаження програми,
зазвичай такого, яке не підтримує стан. Розгортання забезпечує декларативні оновлення дляС тручкиі Набори реплік.

Ви описуєте бажаний стан у розгортанні, а розгортанняКонтролерзмінює фактичний стан на бажаний стан з контрольованою швидкістю. Ви можете визначити розгортання для створення нових наборів реплік або для видалення існуючих розгортань та використання всіх їхніх ресурсів з новими розгортаннями.

Примітка:
Не керуйте наборами реплік, що належать розгортанню. Розгляньте можливість створення запиту в головному репозиторії Kubernetes, якщо ваш варіант використання не описано нижче.
Випадок використання
Нижче наведено типові випадки використання розгортань:

Створіть розгортання для розгортання ReplicaSet . ReplicaSet створює Pods у фоновому режимі. Перевірте статус розгортання, щоб побачити, чи воно успішне.
Оголосіть новий стан подів , оновивши PodTemplateSpec розгортання. Створюється новий набір реплік ReplicaSet, і розгортання поступово масштабує його, одночасно зменшуючи старий набір реплік ReplicaSet, забезпечуючи заміну подів з контрольованою швидкістю. Кожен новий набір реплік оновлює редакцію розгортання.
Відкат до попередньої версії розгортання, якщо поточний стан розгортання нестабільний. Кожен відкат оновлює версію розгортання.
Збільште масштаб розгортання для забезпечення більшого навантаження .
Призупиніть розгортання розгортання , щоб застосувати кілька виправлень до його PodTemplateSpec, а потім відновіть його, щоб розпочати нове розгортання.
Використовуйте статус розгортання як індикатор того, що розгортання зависло.
Очистіть старі набори реплік , які вам більше не потрібні.
Створення розгортання
Нижче наведено приклад розгортання. Він створює набір реплік (ReplicaSet) для створення трьох nginxподів (Pods):